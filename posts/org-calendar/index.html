<!doctype html><html><head><meta charset=utf-8><title>Viewing Important Dates in Emacs - M. Rincón</title><meta name=viewport content="width=device-width,initial-scale=1"><link rel=stylesheet type=text/css media=screen href=https://foxfriday.github.io/css/light.css><link rel=stylesheet type=text/css media=screen href=https://foxfriday.github.io/css/syntax.css></head><body><div class="container wrapper post"><div class=header><base href=https://foxfriday.github.io/><div class=site-description><h1 class=site-title><a href=https://foxfriday.github.io/>M. Rincón
</a>&mdash;
<small>Guided by asteriks</small></h1></div><nav class=nav><ul class=flat><li><a href=/>Home</a></li><li><a href=posts/>Posts</a></li><li><a href=/tags>Tags</a></li><li><a href=/index.xml>Rss</a></li><li><a href=https://github.com/foxfriday>GitHub</a></li></ul></nav></div><div class=post-header><h1 class=title>Viewing Important Dates in Emacs</h1><div class=meta>2022-16.05
<span class=modified-label>Revised: 2022-17.05</span></div></div><div class=markdown><p>For a while I tried to use <code>org-mode</code> to schedule appointments and keep track of
my calendar. But eventually I gave up. I never found an effective way to
coordinate with others. I still use Emacs to mark non-calendar-blocking events
like market half days. My phone can easily keep track of regular events like
birthdays. But recurrent events with more complicated rules are a pain. For
example, crude oil futures expire the third business day before the 25th day of
the month if the 25th is a business day, or the fourth prior day if the 25th is
a holiday. Adding those dates to Outlook is a bit frustrating. So for those days
I still use Emacs along with a small personal package with some additional <a href=https://github.com/foxfriday/date-functions>date
functions</a><sup class=footnote-reference><a id=footnote-reference-1 href=#footnote-1>1</a></sup>.</p><p>The library provides just two public functions. The functions are just
additional <a href=https://www.gnu.org/software/emacs/manual/html_node/emacs/Sexp-Diary-Entries.html>sexp entries</a> for the calendar. The first marks the start of my
workweek. The second takes some rules and marks the dates that match the rules.
For example, if I want to find the last work day of the month according to U.S.
federal calendar, I can add this line to my diary:</p><div class="src src-emacs-lisp"><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-emacs-lisp data-lang=emacs-lisp><span class=line><span class=cl> <span class=c1>;; -*- mode: diary; mode: auto-revert; -*-</span>
</span></span><span class=line><span class=cl> <span class=nv>%%</span><span class=p>(</span><span class=nv>df-diary-expirations</span> <span class=mi>1</span> <span class=mi>-1</span><span class=p>)</span> <span class=nv>Last</span> <span class=nv>work</span> <span class=nv>day</span> <span class=nv>of</span> <span class=nv>the</span> <span class=nv>month</span></span></span></code></pre></td></tr></table></div></div></div><p>Or I can mark the last work day before the 25th of every month according to
a different calendar:</p><div class="src src-emacs-lisp"><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-emacs-lisp data-lang=emacs-lisp><span class=line><span class=cl> <span class=nv>%%</span><span class=p>(</span><span class=nv>df-diary-expirations</span> <span class=mi>25</span> <span class=mi>-1</span> <span class=nv>df-globex-holidays</span><span class=p>)</span> <span class=nv>Work</span> <span class=nv>day</span> <span class=nv>before</span> <span class=nv>the</span> <span class=nv>25</span></span></span></code></pre></td></tr></table></div></div></div><p>Or something even more complicated, like finding the first work day on or before
the 25th, and then mark the third work day before that day with a special color:</p><div class="src src-emacs-lisp"><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-emacs-lisp data-lang=emacs-lisp><span class=line><span class=cl> <span class=nv>%%</span><span class=p>(</span><span class=nv>df-diary-expirations</span> <span class=mi>25</span> <span class=mi>-3</span> <span class=nv>df-globex-holidays</span> <span class=no>t</span> <span class=nv>personal-face</span><span class=p>)</span> <span class=nv>Hello</span></span></span></code></pre></td></tr></table></div></div></div><p>Now I can open the calendar with <code>M-x calendar</code>, press <code>m</code> and the days that match
the rule are colored with whatever color I choose. I can also press <code>d</code> and get
some information on the date, in this case the string "Hello".</p><p>To display the events in the fancy org-mode agenda along with holidays, I added
the following to my configuration:</p><div class="src src-emacs-lisp"><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-emacs-lisp data-lang=emacs-lisp><span class=line><span class=cl> <span class=p>(</span><span class=nb>setq</span> <span class=nv>org-agenda-include-diary</span> <span class=no>t</span><span class=p>)</span></span></span></code></pre></td></tr></table></div></div></div><p><sup class=footnote-reference><a id=footnote-reference-1 href=#footnote-1>1</a></sup>This program comes with absolutely no warranty.</p><div class=footnotes><hr class=footnotes-separatator><div class=footnote-definitions></div></div></div><div class=post-tags><nav class="nav tags"><ul class=flat><li><a href=/tags/emacs>emacs</a></li></ul></nav></div></div><div class="footer wrapper"><nav class=nav><div>All content by M. Rincón
is licensed under
<a href="http://creativecommons.org/licenses/by/4.0/?ref=chooser-v1" target=_blank rel="license noopener noreferrer" style=display:inline-block>CC BY 4.0</a></div></nav></div></body></html>