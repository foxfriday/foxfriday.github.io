<?xml version="1.0" encoding="utf-8" standalone="yes"?><rss version="2.0" xmlns:atom="http://www.w3.org/2005/Atom"><channel><title>M. Rincón</title><link>https://mrincon.net/</link><description>Recent content on M. Rincón</description><generator>Hugo -- gohugo.io</generator><language>en-us</language><copyright>M. Rincón</copyright><lastBuildDate>Tue, 27 Dec 2022 00:00:00 +0000</lastBuildDate><atom:link href="https://mrincon.net/index.xml" rel="self" type="application/rss+xml"/><item><title>Making ProtonVPN Usable on Linux</title><link>https://mrincon.net/posts/linux-pvpn-openvpn/</link><pubDate>Tue, 27 Dec 2022 00:00:00 +0000</pubDate><guid>https://mrincon.net/posts/linux-pvpn-openvpn/</guid><description>&lt;p>
Proton provides a GUI and a console application for Linux, but on 2022, it is nearly
unusable. It consumes up to 2 GB of memory idled, drops connections and fails to reconnect
unless the kill switch is deleted using &lt;code>nmcli&lt;/code>. And the command line application has a
&lt;a href="https://github.com/ProtonVPN/linux-cli/issues/62">bizarre dependency&lt;/a> on &lt;code>nm-applet&lt;/code>, which of course means it cannot be used on a headless
machine. Brilliant. And it &lt;a href="https://github.com/ProtonVPN/linux-app/issues/49">appears&lt;/a> that &lt;code>ProtonVPN&lt;/code> is not going to fix this. The solution
is to use &lt;code>ProtonVPN&lt;/code> with &lt;code>OpenVPN&lt;/code> or &lt;code>Wireguard&lt;/code> —or better yet, find a provider that cares
about Linux. Fortunately, using &lt;code>OpenVPN&lt;/code> is easy.&lt;/p>
&lt;p>
First, I logged into &lt;code>ProtonVPN&lt;/code>, and in the download section, made some configuration
files. They have &lt;code>ovpn&lt;/code> files for &lt;code>OpenVPN&lt;/code> and &lt;code>conf&lt;/code> files for &lt;code>Wireguard&lt;/code>. Once downloaded, I
added the connections using &lt;code>NetworkManager&lt;/code>. I also gave them a friendlier name, and added
a username. The username and password are different from the username and password I use
to sign in to my account —it can be found in the comment section of the &lt;code>ovpn&lt;/code> file, along
with some configuration options. The password is in the account section of the website.&lt;/p>
&lt;div class="src src-sh">
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;span class="lnt">4
&lt;/span>&lt;span class="lnt">5
&lt;/span>&lt;span class="lnt">6
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-sh" data-lang="sh">&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># Add the connection&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">nmcli con import &lt;span class="nb">type&lt;/span> openvpn file &amp;lt;filename.ovpn&amp;gt;
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># Rename the connection&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">nmcli con modify &amp;lt;old name&amp;gt; connection.id &amp;lt;new name&amp;gt;
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># Add the user name&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">nmcli con modify &amp;lt;new name&amp;gt; vpn.user-name &amp;lt;user name&amp;gt;&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>
&lt;/div>
&lt;p>
The next step is to disable &lt;code>IPv6&lt;/code>. Doing this with &lt;code>NetworkManager&lt;/code> will also set the correct
&lt;code>sysctl&lt;/code> values in the kernel.&lt;/p>
&lt;div class="src src-sh">
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;span class="lnt">4
&lt;/span>&lt;span class="lnt">5
&lt;/span>&lt;span class="lnt">6
&lt;/span>&lt;span class="lnt">7
&lt;/span>&lt;span class="lnt">8
&lt;/span>&lt;span class="lnt">9
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-sh" data-lang="sh">&lt;span class="line">&lt;span class="cl">nmcli con modify &amp;lt;connection&amp;gt; ipv6.method &lt;span class="s2">&amp;#34;disabled&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># restart connection&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">nmcl con up &amp;lt;connetion&amp;gt;
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># show settings&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">nmcli -f ipv6 connection show &amp;lt;connection&amp;gt;
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># Verify (1 means that IPv6 is disabled)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># Find the device&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">nmcli device
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">cat /proc/sys/net/ipv6/conf/&amp;lt;device&amp;gt;/disable_ipv6&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>
&lt;/div>
&lt;p>
One disadvantage of this method is that it has to be done for every device. On a hardwired
device, this method may be enough. On a laptop, which may switch from hardwired to &lt;code>WiFi&lt;/code>,
adding the following lines to &lt;code>/etc/sysctl.conf&lt;/code> and reloading the changes with &lt;code>sysctl -p&lt;/code>
may be a better option.&lt;/p>
&lt;div class="src src-text">
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;span class="lnt">4
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-text" data-lang="text">&lt;span class="line">&lt;span class="cl">net.ipv6.conf.all.disable_ipv6 = 1
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">net.ipv6.conf.default.disable_ipv6 = 1
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">net.ipv6.conf.lo.disable_ipv6 = 1
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">net.ipv6.conf.tun0.disable_ipv6 = 1&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>
&lt;/div>
&lt;p>
An interesting option is to use the &lt;code>NetworkManager Dispatcher&lt;/code> to disable &lt;code>IpV6&lt;/code> only when I
connect to the &lt;code>VPN&lt;/code>. Whenever there&amp;#39;s an event, the &lt;code>NetworkManager&lt;/code>&amp;#39;s dispatcher runs the
scripts placed in &lt;code>/usr/NetworkManager/dispatcher.d&lt;/code> in alphabetical order, as long as the
script is an executable owned by root, and the file is not writable by group or other (see
&lt;code>man NetworkManager-dispatcher&lt;/code>). The scripts get two arguments: the name of device and the
event.&lt;/p>
&lt;p>
To make this work I first started the dispatcher.&lt;/p>
&lt;div class="src src-sh">
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-sh" data-lang="sh">&lt;span class="line">&lt;span class="cl">systemctl &lt;span class="nb">enable&lt;/span> --now NetworkManager-dispatcher&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>
&lt;/div>
&lt;p>
Then, I made a small script inside &lt;code>dispatcher.d/&lt;/code>.&lt;/p>
&lt;div class="src src-sh">
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt">10
&lt;/span>&lt;span class="lnt">11
&lt;/span>&lt;span class="lnt">12
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-sh" data-lang="sh">&lt;span class="line">&lt;span class="cl">&lt;span class="cp">#!/bin/sh
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="cp">&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># ensure root ownership and make sure its an executable&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="k">case&lt;/span> &lt;span class="s2">&amp;#34;&lt;/span>&lt;span class="nv">$2&lt;/span>&lt;span class="s2">&amp;#34;&lt;/span> in
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> vpn-up&lt;span class="o">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nb">echo&lt;/span> &lt;span class="m">1&lt;/span> &amp;gt; /proc/sys/net/ipv6/conf/all/disable_ipv6
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">;;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> vpn-down&lt;span class="o">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nb">echo&lt;/span> &lt;span class="m">0&lt;/span> &amp;gt; /proc/sys/net/ipv6/conf/all/disable_ipv6
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">;;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="k">esac&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>
&lt;/div>
&lt;p>
Now starting a connection disables &lt;code>IpV6&lt;/code>. Unfortunately, &lt;code>vpn-down&lt;/code> is not triggered when the
&lt;code>VPN&lt;/code> disconnects forcefully.&lt;/p>
&lt;div id="outline-container-headline-1" class="outline-3">
&lt;h3 id="headline-1">
Adding a Killswitch
&lt;/h3>
&lt;div id="outline-text-headline-1" class="outline-text-3">
&lt;p>
I also wanted a &lt;code>killswitch&lt;/code>, so I used &lt;code>ufw&lt;/code> to configure one. First I found the scope of my
&lt;code>LAN&lt;/code> —ignore the 127.0.0.1/8, that&amp;#39;s the loop back.&lt;/p>
&lt;div class="src src-sh">
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-sh" data-lang="sh">&lt;span class="line">&lt;span class="cl">ip address &lt;span class="p">|&lt;/span> grep inet&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>
&lt;/div>
&lt;p>
Because I wanted to be able to reconnect without turning off the firewall, I wrote down
the VPN protocol, IP, and port in the &lt;code>ovpn&lt;/code> file and made exceptions for them. In the file,
these have the format &lt;code>REMOTE &amp;lt;ip&amp;gt; &amp;lt;port&amp;gt;&lt;/code>. Optionally, &lt;code>systemd&lt;/code> can set the firewall using
&lt;code>ufw&lt;/code> to its last state after restart. So if the firewall was disabled, it will remain
disabled after restart.&lt;/p>
&lt;div class="src src-sh">
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt">10
&lt;/span>&lt;span class="lnt">11
&lt;/span>&lt;span class="lnt">12
&lt;/span>&lt;span class="lnt">13
&lt;/span>&lt;span class="lnt">14
&lt;/span>&lt;span class="lnt">15
&lt;/span>&lt;span class="lnt">16
&lt;/span>&lt;span class="lnt">17
&lt;/span>&lt;span class="lnt">18
&lt;/span>&lt;span class="lnt">19
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-sh" data-lang="sh">&lt;span class="line">&lt;span class="cl">ufw disable
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">ufw --force reset
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># whitelist the LAN&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">ufw allow in to 192.168.1.0/24
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">ufw allow out to 192.168.1.0/24
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># block all incoming and outgoing traffic by default&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">ufw default deny outgoing
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">ufw default deny incoming
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># allow exception to the vpn, assuming udp&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">ufw allow out to &amp;lt;ip&amp;gt; port &amp;lt;port&amp;gt; proto udp
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># send everything through the tunnel&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">ufw allow in on tun0 from any to any
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">ufw allow out on tun0 from any to any
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># enable&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">ufw &lt;span class="nb">enable&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># check configuration&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">uwf status verbose
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># turn on restart&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">systemctl &lt;span class="nb">enable&lt;/span> ufw&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>
&lt;/div>
&lt;p>
At this point there should not be any connection outside the LAN and the VPN servers until
the VPN is activated.&lt;/p>
&lt;div class="src src-sh">
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt">10
&lt;/span>&lt;span class="lnt">11
&lt;/span>&lt;span class="lnt">12
&lt;/span>&lt;span class="lnt">13
&lt;/span>&lt;span class="lnt">14
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-sh" data-lang="sh">&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># ping google should fail&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">ping 8.8.8.8
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># but work after vpn is activate&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">nmcli --ask con up &amp;lt;vpn name&amp;gt;
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">ping google
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># we can also check for leaks&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">curl https://ipleak.net/json/ &lt;span class="p">|&lt;/span> bat -l json
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># and in the DNS&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="nv">session&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="k">$(&lt;/span>&lt;span class="nb">echo&lt;/span> mrfox &lt;span class="p">|&lt;/span> sha1sum&lt;span class="k">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="k">for&lt;/span> i in &lt;span class="k">$(&lt;/span>seq &lt;span class="m">5000&lt;/span> 5003&lt;span class="k">)&lt;/span>&lt;span class="p">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="k">do&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> curl &lt;span class="s2">&amp;#34;https://&lt;/span>&lt;span class="si">${&lt;/span>&lt;span class="nv">session&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="nv">0&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="nv">40&lt;/span>&lt;span class="si">}&lt;/span>&lt;span class="s2">-&lt;/span>&lt;span class="si">${&lt;/span>&lt;span class="nv">i&lt;/span>&lt;span class="si">}&lt;/span>&lt;span class="s2">.ipleak.net/dnsdetection/&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> sleep &lt;span class="m">1&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="k">done&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>
&lt;/div>
&lt;p>
Additionally, I used the dispatcher to set and delete the firewall rules when the
connection is up or down.&lt;/p>
&lt;/div>
&lt;/div>
&lt;div id="outline-container-headline-2" class="outline-3">
&lt;h3 id="headline-2">
Saving Passwords
&lt;/h3>
&lt;div id="outline-text-headline-2" class="outline-text-3">
&lt;p>
With &lt;code>nmcli&lt;/code>, the password can be entered manually using the &lt;code>--ask&lt;/code> flag, or it can be stored
in a file with the line &lt;code>vpn.secrets.password:&amp;lt;the password&amp;gt;&lt;/code>.&lt;/p>
&lt;div class="src src-sh">
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;span class="lnt">4
&lt;/span>&lt;span class="lnt">5
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-sh" data-lang="sh">&lt;span class="line">&lt;span class="cl">nmcli --ask con up &amp;lt;connection&amp;gt;
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># with a file&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">chown root:root &amp;lt;file&amp;gt;
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">chmod &lt;span class="m">400&lt;/span> &amp;lt;file&amp;gt;
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">nmcli con up id &amp;lt;connection&amp;gt; passwd-file &amp;lt;file&amp;gt;&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>
&lt;/div>
&lt;p>
Another alternative is to place the password in the configuration file stored in
&lt;code>/etc/NetworkManager/system-connections&lt;/code>. For a VPN connection, I had to change the password
flag to zero, and add the password in the secrets section.&lt;/p>
&lt;div class="src src-conf">
&lt;pre tabindex="0">&lt;code class="language-conf" data-lang="conf">[vpn]
password-flags=0
[vpn-secrets]
password=&amp;lt;password&amp;gt;&lt;/code>&lt;/pre>
&lt;/div>
&lt;/div>
&lt;/div>
&lt;div id="outline-container-headline-3" class="outline-3">
&lt;h3 id="headline-3">
Reverting changes
&lt;/h3>
&lt;div id="outline-text-headline-3" class="outline-text-3">
&lt;p>
If I need to, I can revert these changes in a few steps. First, allow &lt;code>ipv6&lt;/code> again by
removing the new lines in &lt;code>/etc/sysctl.conf&lt;/code> and reloading the changes with &lt;code>sysctl -p&lt;/code>, or
setting the &lt;code>ipv6.method&lt;/code> of the device back to &lt;code>auto&lt;/code>. I can then disable the firewall,
disconnect, and delete the connection. I can also remove any no longer needed certificates
in &lt;code>~/.cert/nm-openvpn/&lt;/code>.&lt;/p>
&lt;div class="src src-sh">
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;span class="lnt">4
&lt;/span>&lt;span class="lnt">5
&lt;/span>&lt;span class="lnt">6
&lt;/span>&lt;span class="lnt">7
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-sh" data-lang="sh">&lt;span class="line">&lt;span class="cl">nmcli con modify &amp;lt;connection&amp;gt; ipv6.method &lt;span class="s2">&amp;#34;auto&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">nmcli con down &amp;lt;connection&amp;gt;
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">nmcli con delete &amp;lt;connection&amp;gt;
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">ufw disable
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">ufw reset
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># if needed&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">systemctl disable ufw&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>
&lt;/div>
&lt;/div>
&lt;/div></description></item><item><title>Tracking Packages With Org-Mode</title><link>https://mrincon.net/posts/org-tracking/</link><pubDate>Tue, 06 Dec 2022 00:00:00 +0000</pubDate><guid>https://mrincon.net/posts/org-tracking/</guid><description>&lt;p>
December is the season to mail and receive packages. To keep track of them, I create a
&lt;code>TODO&lt;/code> item for each package in an Emacs&amp;#39; org file. I make note of the mailing date, the
content of the package, and the tracking number. The advantage of using Emacs is that a
few line of code can make the tracking numbers clickable.&lt;/p>
&lt;div class="src src-emacs-lisp">
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt">10
&lt;/span>&lt;span class="lnt">11
&lt;/span>&lt;span class="lnt">12
&lt;/span>&lt;span class="lnt">13
&lt;/span>&lt;span class="lnt">14
&lt;/span>&lt;span class="lnt">15
&lt;/span>&lt;span class="lnt">16
&lt;/span>&lt;span class="lnt">17
&lt;/span>&lt;span class="lnt">18
&lt;/span>&lt;span class="lnt">19
&lt;/span>&lt;span class="lnt">20
&lt;/span>&lt;span class="lnt">21
&lt;/span>&lt;span class="lnt">22
&lt;/span>&lt;span class="lnt">23
&lt;/span>&lt;span class="lnt">24
&lt;/span>&lt;span class="lnt">25
&lt;/span>&lt;span class="lnt">26
&lt;/span>&lt;span class="lnt">27
&lt;/span>&lt;span class="lnt">28
&lt;/span>&lt;span class="lnt">29
&lt;/span>&lt;span class="lnt">30
&lt;/span>&lt;span class="lnt">31
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-emacs-lisp" data-lang="emacs-lisp">&lt;span class="line">&lt;span class="cl">&lt;span class="p">(&lt;/span>&lt;span class="nb">defun&lt;/span> &lt;span class="nv">org-link-track-ups&lt;/span> &lt;span class="p">(&lt;/span>&lt;span class="nv">path&lt;/span> &lt;span class="nv">arg&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="s">&amp;#34;Track a ups package where PATH is the tracking number.&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">(&lt;/span>&lt;span class="nv">browse-url&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">(&lt;/span>&lt;span class="nv">url-encode-url&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">(&lt;/span>&lt;span class="nf">concat&lt;/span> &lt;span class="s">&amp;#34;https://www.ups.com/track?loc=en_US&amp;amp;tracknum=&amp;#34;&lt;/span> &lt;span class="nv">path&lt;/span>&lt;span class="p">))&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nv">arg&lt;/span>&lt;span class="p">))&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="p">(&lt;/span>&lt;span class="nb">defun&lt;/span> &lt;span class="nv">org-link-track-usps&lt;/span> &lt;span class="p">(&lt;/span>&lt;span class="nv">path&lt;/span> &lt;span class="nv">arg&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="s">&amp;#34;Track a usps package where PATH is the tracking number.&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">(&lt;/span>&lt;span class="nv">browse-url&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">(&lt;/span>&lt;span class="nv">url-encode-url&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">(&lt;/span>&lt;span class="nf">concat&lt;/span> &lt;span class="s">&amp;#34;https://tools.usps.com/go/TrackConfirmAction.action?tLabels=&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nv">path&lt;/span>&lt;span class="p">))&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nv">arg&lt;/span>&lt;span class="p">))&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="p">(&lt;/span>&lt;span class="nb">defun&lt;/span> &lt;span class="nv">org-link-track-fedex&lt;/span> &lt;span class="p">(&lt;/span>&lt;span class="nv">path&lt;/span> &lt;span class="nv">arg&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="s">&amp;#34;Track a fedex package where PATH is the tracking number.&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">(&lt;/span>&lt;span class="nv">browse-url&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">(&lt;/span>&lt;span class="nv">url-encode-url&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">(&lt;/span>&lt;span class="nf">concat&lt;/span> &lt;span class="s">&amp;#34;https://www.fedex.com/fedextrack/?trknbr=&amp;#34;&lt;/span> &lt;span class="nv">path&lt;/span>&lt;span class="p">))&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nv">arg&lt;/span>&lt;span class="p">))&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="p">(&lt;/span>&lt;span class="nv">org-link-set-parameters&lt;/span> &lt;span class="s">&amp;#34;ups&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nb">:follow&lt;/span> &lt;span class="ss">&amp;#39;org-link-track-ups&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nb">:face&lt;/span> &lt;span class="o">&amp;#39;&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="nb">:foreground&lt;/span> &lt;span class="s">&amp;#34;green&amp;#34;&lt;/span> &lt;span class="nb">:underline&lt;/span> &lt;span class="no">t&lt;/span>&lt;span class="p">))&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="p">(&lt;/span>&lt;span class="nv">org-link-set-parameters&lt;/span> &lt;span class="s">&amp;#34;usps&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nb">:follow&lt;/span> &lt;span class="ss">&amp;#39;org-link-track-usps&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nb">:face&lt;/span> &lt;span class="o">&amp;#39;&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="nb">:foreground&lt;/span> &lt;span class="s">&amp;#34;green&amp;#34;&lt;/span> &lt;span class="nb">:underline&lt;/span> &lt;span class="no">t&lt;/span>&lt;span class="p">))&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="p">(&lt;/span>&lt;span class="nv">org-link-set-parameters&lt;/span> &lt;span class="s">&amp;#34;fedex&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nb">:follow&lt;/span> &lt;span class="ss">&amp;#39;org-link-track-fedex&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nb">:face&lt;/span> &lt;span class="o">&amp;#39;&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="nb">:foreground&lt;/span> &lt;span class="s">&amp;#34;green&amp;#34;&lt;/span> &lt;span class="nb">:underline&lt;/span> &lt;span class="no">t&lt;/span>&lt;span class="p">))&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>
&lt;/div>
&lt;p>
Then, I can just type &lt;code>[[ups:&amp;lt;tracking number]]&lt;/code> in an org file and &lt;code>open-at-point&lt;/code>
lets me know where is my package.&lt;/p></description></item></channel></rss>